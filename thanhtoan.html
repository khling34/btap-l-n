<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thanh To√°n | T√¢y B·∫Øc Tour</title>
  <style>
    body {
      font-family: monospace;
      background: #f1f1f1;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .step {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    .step div {
      text-align: center;
    }
    .step .active {
      color: green;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .summary, .form-group {
      margin-bottom: 20px;
    }
    .summary h3 {
      margin-top: 0;
    }
    .total {
      font-size: 1.2em;
      font-weight: bold;
      margin-top: 10px;
      color:brown;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      font-size: 1em;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="step">
      <div id="step1Indicator" class="active">1<br>X√°c Th·ª±c</div>
      <div id="step2Indicator">2<br>H√†nh Kh√°ch</div>
      <div id="step3Indicator">3<br>Thanh To√°n</div>
    </div>

    <!-- B∆∞·ªõc 1: X√°c Th·ª±c Chuy·∫øn ƒêi -->
    <div id="step1">
      <div class="summary">
        <h3>Th√¥ng tin chuy·∫øn ƒëi</h3>
        <div id="routeInfo">ƒêang t·∫£i...</div>
        
        <div class="form-group">
            <label for="travelDate">Ng√†y ƒëi</label>
            <input type="date" id="travelDate">
            <div id="dateError" style="color: red; font-size: 0.9em; margin-top: 5px;"></div> <!-- c·∫£nh b√°o -->
          </div>
                 
        <div class="form-group">
            <label for="quantity">S·ªë l∆∞·ª£ng h√†nh kh√°ch</label>
            <input type="number" id="quantity" min="1" value="1" onchange="updateTotal()">
          </div> 
        <div class="total" id="totalPrice"></div>         
      </div>
      <button onclick="checkAndGoToStep2()">Ti·∫øp t·ª•c</button>
    </div>

    <!-- B∆∞·ªõc 2: Th√¥ng Tin H√†nh Kh√°ch -->
    <div id="step2" class="hidden">
      <div id="passengerList"></div>
      <button onclick="nextStep(1)">Quay l·∫°i</button>
      <button onclick="validatePassengerInfo()">Ti·∫øp t·ª•c</button>
    </div>

    <!-- B∆∞·ªõc 3: Thanh To√°n -->
    <div id="step3" class="hidden">
      <div class="form-group">
        <label for="card">S·ªë Th·∫ª</label>
        <input type="text" id="card" placeholder="Nh·∫≠p s·ªë th·∫ª..." />
      </div>
      <div class="form-group">
        <label for="bank">Ng√¢n H√†ng</label>
        <input type="text" id="bank" placeholder="Nh·∫≠p t√™n ng√¢n h√†ng..." />
      </div>
      <button onclick="nextStep(2)">Quay l·∫°i</button>
      <button onclick="pay()">Thanh to√°n</button>
    </div>
  </div>

  <script>
    const ticket = JSON.parse(localStorage.getItem('selectedTicket'));
    const routeInfo = document.getElementById('routeInfo');
    const totalPrice = document.getElementById('totalPrice');

    if (ticket) {
  routeInfo.innerHTML = `
    <strong>Tuy·∫øn:</strong> ${ticket.route} <br>
    <strong>Th·ªùi gian:</strong> ${ticket.time} <br>
    <strong>Gi√° v√©:</strong> ${ticket.price.toLocaleString()} ƒë / h√†nh kh√°ch
  `;
  updateTotal();
}

function updateTotal() {
  const quantity = parseInt(document.getElementById('quantity').value) || 1;
  const total = ticket.price * quantity;
  totalPrice.textContent = `T·ªïng c·ªông: ${total.toLocaleString()} ƒë`;
  ticket.quantity = quantity;
  localStorage.setItem('selectedTicket', JSON.stringify(ticket)); // C·∫≠p nh·∫≠t l·∫°i localStorage
}
function nextStep(step) {
  for (let i = 1; i <= 3; i++) {
    document.getElementById(`step${i}`).classList.add('hidden');
    document.getElementById(`step${i}Indicator`).classList.remove('active');
  }

  document.getElementById(`step${step}`).classList.remove('hidden');
  document.getElementById(`step${step}Indicator`).classList.add('active');

  // ‚úÖ Khi chuy·ªÉn sang b∆∞·ªõc 2 ‚Üí lu√¥n t·∫°o l·∫°i √¥ nh·∫≠p
  if (step === 2) {
    generatePassengerFields(ticket.quantity || 1);
  }
}
    function validatePassengerInfo() {
    const quantity = ticket.quantity || 1;
    let valid = true;
    let passengers = [];

    for (let i = 1; i <= quantity; i++) {
        const name = document.getElementById(`name${i}`).value.trim();
        const phone = document.getElementById(`phone${i}`).value.trim();

        if (!name || !phone) {
        alert(`Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß h·ªç t√™n v√† s·ªë ƒëi·ªán tho·∫°i cho h√†nh kh√°ch ${i}.`);
        valid = false;
        break;
        }

        passengers.push({ name, phone });
    }

    if (valid) {
        // C√≥ th·ªÉ l∆∞u danh s√°ch h√†nh kh√°ch n·∫øu c·∫ßn
        ticket.passengers = passengers;
        localStorage.setItem('selectedTicket', JSON.stringify(ticket));
        nextStep(3); // Chuy·ªÉn sang b∆∞·ªõc thanh to√°n
    }
    }
    function pay() {
  const card = document.getElementById('card').value.trim();
  const bank = document.getElementById('bank').value.trim();
  const ticket = JSON.parse(localStorage.getItem('selectedTicket')) || {};

  if (!card || !bank) {
    alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin thanh to√°n.");
    return;
  }

  // T·∫°o m√£ ƒë·∫∑t ch·ªó v√† l∆∞u v√†o l·ªãch s·ª≠
  const lichSu = JSON.parse(localStorage.getItem('lichSuDatCho')) || [];
  const maDatCho = 'XE' + Math.floor(100000 + Math.random() * 900000);

  lichSu.push({
    maDatCho,
    loai: 'car',
    name: car.name,
    date: car.date,
    days: car.days,
    guest: car.guest
  });

  localStorage.setItem('lichSuDatCho', JSON.stringify(lichSu));
  alert("‚úÖ Thanh to√°n th√†nh c√¥ng! M√£ ƒë·∫∑t ch·ªó c·ªßa b·∫°n l√†: " + maDatCho);

  window.location.href = "index.html";
}
  </script>
  <script>
  function generatePassengerFields(quantity) {
    const container = document.getElementById('passengerList');
    container.innerHTML = ''; // X√≥a c≈©
  
    for (let i = 1; i <= quantity; i++) {
      const group = document.createElement('div');
      group.className = 'form-group';
      group.innerHTML = `
        <label for="name${i}">H·ªç v√† t√™n h√†nh kh√°ch ${i}</label>
        <input type="text" id="name${i}" placeholder="Nh·∫≠p h·ªç t√™n...">
        <label for="phone${i}">S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="text" id="phone${i}" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i...">
      `;
      container.appendChild(group);
    }
  }
  function updateTotal() {
  const quantity = parseInt(document.getElementById('quantity').value) || 1;
  const total = ticket.price * quantity;
  totalPrice.textContent = `T·ªïng c·ªông: ${total.toLocaleString()} ƒë`;
  ticket.quantity = quantity;
  localStorage.setItem('selectedTicket', JSON.stringify(ticket));
  generatePassengerFields(quantity); // üëà Th√™m d√≤ng n√†y
}
  </script>
<script>
function checkAndGoToStep2() {
    const dateInput = document.getElementById('travelDate');
    const errorBox = document.getElementById('dateError');
    const date = dateInput.value;
  
    if (!date) {
      errorBox.textContent = " Vui l√≤ng ch·ªçn ng√†y ƒëi.";
      dateInput.focus();
      return;
    }
  
    // X√≥a c·∫£nh b√°o n·∫øu h·ª£p l·ªá
    errorBox.textContent = "";
  
    ticket.date = date;
    localStorage.setItem('selectedTicket', JSON.stringify(ticket));
    nextStep(2);
  }
</script>
  
</body>
</html>